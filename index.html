<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aircraft Status Dashboard</title>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @keyframes blink {
            0%,100%{opacity:1}
            50%{opacity:.3}
        }
        .blink{animation:blink 1.3s infinite}

        .gradient-bg{
            background:linear-gradient(135deg,#1e3a8a,#020617);
        }
        .glass{
            background:rgba(255,255,255,.95);
            backdrop-filter:blur(10px);
            border-radius:18px;
        }
        .insp-badge{
            background:#dc2626;
            color:#fff;
            font-size:11px;
            font-weight:800;
            padding:6px 12px;
            border-radius:8px;
            text-align:center;
        }
    </style>
</head>

<body class="gradient-bg min-h-screen">
<div id="root"></div>

<script type="text/babel">
const {useState,useEffect}=React;

function Dashboard(){
    const [aircraft,setAircraft]=useState([]);
    const [loading,setLoading]=useState(true);
    const [nextSync,setNextSync]=useState(300);

    const SHEET_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vSXiRXaJISr4tcW13tBxLXI7heUjDbCyGyyABHPZIrx-m2YqXWP0oyeTw1VL4slZ0dJrrngl3CsvO2z/pub?gid=0&single=true&output=csv";

    async function syncData(){
        try{
            const res=await fetch(SHEET_URL);
            const text=await res.text();
            const rows=text.trim().split("\n").slice(1);
            const data=rows.map(r=>{
                const c=r.split(",").map(v=>v.replace(/"/g,"").trim());
                return{
                    slNo:c[0],
                    registration:c[1],
                    status:c[3],
                    dailyInsp:c[4],
                    weeklyInsp:c[5],
                    mel:c[6]||"",
                    remarks:c[7]||""
                };
            });
            setAircraft(data);
        }catch(e){console.error(e)}
        setLoading(false);
    }

    useEffect(()=>{
        syncData();
        const t=setInterval(()=>setNextSync(p=>p<=1?300:p-1),1000);
        return()=>clearInterval(t);
    },[]);

    function inspCritical(d){
        if(!d)return false;
        const p=d.split(" ");
        if(p.length<2)return false;
        const [dd,mm,yy]=p[0].split("/");
        const [hh,min]=p[1].split(":");
        const due=new Date(Date.UTC(yy,mm-1,dd,hh,min));
        return (due-new Date())/3600000<=3;
    }

    if(loading){
        return(
            <div className="flex items-center justify-center h-screen text-white text-xl font-bold">
                Loading Fleet Status…
            </div>
        );
    }

    return(
    <div className="max-w-7xl mx-auto p-6">

        <div className="glass p-6 mb-6 shadow-xl">
            <h1 className="text-3xl font-black text-blue-700 flex items-center gap-3">
                ✈️ Fleet Dispatch Dashboard
            </h1>
            <p className="text-slate-500 font-bold text-sm">
                Live Aircraft Serviceability Status
            </p>
        </div>

        <div className="glass shadow-xl overflow-x-auto">
        <table className="w-full">
            <thead className="bg-slate-900 text-white text-xs uppercase">
                <tr>
                    <th className="p-4">No</th>
                    <th className="p-4">Registration</th>
                    <th className="p-4">Status</th>
                    <th className="p-4">Daily Insp</th>
                    <th className="p-4">Weekly Insp</th>
                    <th className="p-4">Dispatch Status</th>
                    <th className="p-4">Alerts</th>
                </tr>
            </thead>

            <tbody className="divide-y bg-white">
            {aircraft.map((a,i)=>{
                const crit = inspCritical(a.dailyInsp) || inspCritical(a.weeklyInsp);
                const ready = a.status?.toUpperCase()==="SERVICEABLE" && (!a.mel || !a.mel.trim());

                return(
                <tr key={i} className="hover:bg-blue-50 transition">
                    <td className="p-4 text-xs text-slate-400 font-bold">{a.slNo}</td>
                    <td className="p-4 font-black text-slate-700">{a.registration}</td>

                    <td className="p-4 text-center">
                        <span className={
                            a.status==="SERVICEABLE"?"text-emerald-700 font-black":
                            a.status==="MRO"?"text-amber-600 font-black":
                            "text-rose-600 font-black"}>
                            {a.status}
                        </span>
                    </td>

                    <td className="p-4 text-sm">{a.dailyInsp}</td>
                    <td className="p-4 text-sm">{a.weeklyInsp}</td>

                    <td className="p-4 font-bold">
                        {ready ? (
                            <span className="text-emerald-600 font-black">
                                ✅ Ready for Dispatch
                            </span>
                        ) : a.mel ? (
                            <span className="text-red-600 font-black">{a.mel}</span>
                        ) : (
                            <span className="text-slate-400">—</span>
                        )}
                    </td>

                    <td className="p-4">
                        {crit ? (
                            <div className="insp-badge blink">⚠ COMPLETE INSP</div>
                        ) : (
                            <span className="text-slate-500 italic">
                                {a.remarks || "Normal"}
                            </span>
                        )}
                    </td>
                </tr>
                );
            })}
            </tbody>
        </table>
        </div>

        <div className="text-right mt-4 text-xs text-white font-mono">
            Next sync in {Math.floor(nextSync/60)}:{String(nextSync%60).padStart(2,"0")}
        </div>

    </div>
    );
}

ReactDOM.createRoot(document.getElementById("root")).render(<Dashboard/>);
</script>
</body>
</html>
